"use strict";angular.module("app",["ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainController",controllerAs:"vm"}).otherwise({redirectTo:"/"})}),function(a){function b(a,b){function c(){var a=new Date,b=a.getDay();b<6?g=!0:6==b?h=!0:i=!0}function d(b,c){var d=[],f=[];b.forEach(function(a){c.forEach(function(b){a.trip_id==b.trip_id&&(1==g?a.trip_id.indexOf("a")==-1&&a.trip_id.indexOf("u")==-1&&d.push(a):1==h?a.trip_id.indexOf("a")!==-1&&d.push(a):d.push(a)),b.trip_id==a.trip_id&&(1==g?b.trip_id.indexOf("a")==-1&&b.trip_id.indexOf("u")==-1&&f.push(b):1==h?b.trip_id.indexOf("a")!==-1&&f.push(b):f.push(b))})}),e.results.departure=d,e.results.arrival=f,a.$apply("results",function(a,b){e.results=a}),console.log(e.results)}var e=a;e.hello="Hello World",e.departureStop=[],e.arrivalStop=[],e.results={},e.selectDeparture=e.departureStop[0],e.selectArrival=e.arrivalStop[0];var f=b;f.open();var g=!1,h=!1,i=!1;c(),e.findbtn=function(a,b){if(e.selectDeparture=b,e.selectArrival=a,console.log(b,a),b===a)return e.results=[],e.err=!0,void(e.error="The Departure and Arrival Stations must be different");var c=f.searchDepartureTimes(b),g=f.searchArrivalTimes(a);return setTimeout(function(){c.length>0&&g.length>0&&d(c,g)},1e3),e.selected=!0,e.err=!1,c?void 0:(console.log(err.stack),err)},f.stops.orderBy("stop_name").toArray().then(function(a){var b=[],c=[];a.map(function(a){b.push(a.stop_name),$.each(b,function(a,b){$.inArray(b,c)===-1&&c.push(b)})}),e.arrivalStop=c,e.departureStop=c})}angular.module("app").controller("MainController",b),b.$inject=["$scope","transitFactory"]}(void 0),function(){function a(){function a(a){for(var b=a.split("\n"),c=[],d=b[0].split(","),e=1;e<b.length;e++){for(var f={},g=b[e].split(","),h=0;h<d.length;h++)f[d[h]]=g[h];c.push(f)}return c}var b=new Dexie("gtfs"),c=["calendar","calendar_dates","stop_times","stops","trips"],d=b;return d.version(1).stores({calendar:"++id,service_id,monday,tuesday,wednesday,thursday,friday,saturday,sunday,start_date,end_date",calendar_dates:"++id,service_id,date,exception_type",stop_times:"++id,trip_id,arrival_time,departure_time,stop_id,stop_sequence,pickup_type,drop_off_type",stops:"++id,stop_id,stop_code,stop_name,stop_lat,stop_lon,zone_id,stop_url,location_type,parent_station,platform_code,wheelchair_boarding",trips:"++id,route_id,service_id,trip_id,trip_headsign,trip_short_name,direction_id,shape_id,wheelchair_accessible,bikes_allowed"}),d.on("ready",function(){return d.calendar.count(function(b){return b>0?void console.log("Already populated, 'gtfs' is already created at this domain."):(console.log("Database is empty. Populating from ajax call..."),Dexie.Promise.all(c.map(function(b){return new Dexie.Promise(function(a,c){$.ajax("gtfs/"+b+".txt",{dataType:"text"}).then(a,c)}).then(function(c){return console.log("Got ajax response for "+b),a(c)}).then(function(a){return console.log("Bulk putting "+a.length+" "+b+" records into database"),d[b].bulkPut(a)}).then(function(){console.log("Done importing "+b)})})).then(function(){console.log("All files successfully imported")}).catch(function(a){throw console.error("Error importing data: "+(a.stack||a)),a}))})}),d.getAllStopTimes=function(){var a=[];return d.stop_times.orderBy("id").toArray().then(function(b){return a.push(b)}).then(function(){console.log(a)}).catch(function(a){throw console.log("Exception thrown: "+(a.stack||a)),a}),a},d.searchDepartureTimes=function(a){var b=[];return d.stops.where("stop_name").startsWithAnyOfIgnoreCase(a).toArray().then(function(a){a.forEach(function(a){d.stop_times.where("stop_id").startsWithAnyOf(a.stop_id).toArray().then(function(a){a.map(function(a){b.push(a)})})})}).then(function(){console.log(b)}).catch(function(a){return console.log(a.stack),a}),b},d.searchArrivalTimes=function(a){var b=[];return d.stops.where("stop_name").startsWithAnyOfIgnoreCase(a).toArray().then(function(a){a.forEach(function(a){d.stop_times.where("stop_id").startsWithAnyOf(a.stop_id).toArray().then(function(a){a.map(function(a){b.push(a)})})})}).then(function(){}).catch(function(a){return console.log(a.stack),a}),b},b}angular.module("app").factory("transitFactory",a)}();